= Create a PostgreSQL sink connector

:page-tag: astra-streaming,connect,pulsar 

To create a PostgreSQL sink connector for {product_name} topics:

. On the *Sinks* tab, select *Create Sink*.
+
image::astream-new-sink.png[New sink]

. Enter the namespace, sink type, and sink name. In this example, we're creating a https://pulsar.apache.org/docs/en/io-jdbc-sink/#example-for-postgresql[JDBC PostgreSQL] sink in the default namespace.
+
image::astream-create-postgres-sink.png[Create the new sink]
+
[NOTE]
====
Your sink name and index name must start with a lowercase alphabetic character.
It can only contain lowercase alphabetic characters, numbers, and hyphens.
====

. You can use the default settings, or expand *Advanced Settings* if you want more control of the sink connector. 
+
image::astream-postgres-advanced.png[Change advanced options]
+
[NOTE]
====
Disabling *Validate Connection* will skip checking the connection. Enabling *Force Create* will skip checking the connection, and will skip validating the configuration.
====

. Choose the sink topic. Messages published to the selected topic will be forwarded to the connected sink. For this example, we're using `topic-1`.
+
image::astream-sink-topic.png[Choose sink topic]

. Complete the fields in *Sink-Specific Configuration*. Different sink connectors have different configuration fields. There are links and descriptions under each value if you're unsure where to find them in your deployment. Review the connector's configuration settings in the https://pulsar.apache.org/docs/en/io-connectors/[Pulsar documentation] for more information. 
+
In this example, {product_name} doesn't have a config definition on file, so we'll be manually building our own `configs` with JSON key-value pairs. 
+
An example JSON config for a PostgreSQL sink connector is below:
+
[source,json]
----
  "configs": {
    "batchSize": 200,
    "jdbcUrl": "jdbc:postgresql://<postgresql-connector-url>:1234/<database-name>",
    "key": "",
    "nonKey": "",
    "password": "sensitive_data_removed",
    "tableName": "table_name",
    "timeoutMs": 500,
    "userName": "postgres"
  },
----

. Enter your config pairs into {product_name} to connect your sink to a PostgreSQL database. In the example below, we're passing values from the above JSON to the `configs` of the sink connector. 
+
image::astream-postgres-configs.png[Postgres sink configs]
+
For more on the JDBC PostgreSQL sink connector configuration, see the https://pulsar.apache.org/docs/en/io-jdbc-sink/#example-for-postgresql[Pulsar documentation].

. Click *Create*. Confirm you have created your new sink connector in the *Sinks* tab. You will see your Postgres sink listed under the *Consumers* tab.
+
image::astream-postgres-sink-created.png[Confirm Postgres sink creation]

== Inspect sink connector with Pulsar CLI

. Inspect your new sink with the Pulsar CLI:
+
[source,bash]
----
./pulsar-admin sinks status \
--tenant tenant-1 \
--namespace default \
--name postgres-sink
----

. This will return a JSON:
+
[source,JSON]
----
{
  "numInstances" : 1,
  "numRunning" : 1,
  "instances" : [ {
    "instanceId" : 0,
    "status" : {
      "running" : true,
      "error" : "",
      "numRestarts" : 0,
      "numReadFromPulsar" : 120,
      "numSystemExceptions" : 0,
      "latestSystemExceptions" : [ ],
      "numSinkExceptions" : 0,
      "latestSinkExceptions" : [ ],
      "numWrittenToSink" : 120,
      "lastReceivedTime" : 1650308780696,
      "workerId" : "pulsar-aws-useast2-function-1"
    }
  } ]
}
----

== Next

For more on {product_name}, see xref:astream-quick-start.adoc[{product_name} Quickstart].
For more on the JDBC Postgres connector configuration, see the https://pulsar.apache.org/docs/en/io-quickstart/#connect-pulsar-to-postgresql[JDBC PostgreSQL connector documentation].

